(function(){'use strict';

Meteor.publish('repos', function (options, searchString) {
  var where = {
    'name': {
      '$regex': '.*' + (searchString || '') + '.*',
      '$options': 'i'
    }
  };
  Counts.publish(this, 'numberOfRepos', Repos.find(where), { noReady: true });
  return Repos.find(where, options);
});

Meteor.methods({

  /*
   * Fetch repositories for given org
   */
  'fetchRepos': function fetchRepos(orgId, startPage, pageLimit) {
    try {
      var result = HTTP.get('https://api.github.com/orgs/' + orgId + '/repos', {
        'headers': { 'user-agent': 'node.js' },
        'params': {
          'page': startPage,
          'per_page': pageLimit
        }
      });
      return result.data;
    } catch (err) {
      throw new Meteor.error("Failed to fetch repositories: " + err);
    }
  }

});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zZXJ2ZXIvcmVwb3MucHVibGlzaC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUE7O0FBRVosTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsVUFBUyxPQUFPLEVBQUUsWUFBWSxFQUFFO0FBQ3RELE1BQUksS0FBSyxHQUFHO0FBQ1YsVUFBTSxFQUFFO0FBQ04sY0FBUSxFQUFFLElBQUksSUFBSSxZQUFZLElBQUksRUFBRSxDQUFBLEFBQUMsR0FBRyxJQUFJO0FBQzVDLGdCQUFVLEVBQUUsR0FBRztLQUNoQjtHQUNGLENBQUM7QUFDRixRQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxlQUFlLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO0FBQzFFLFNBQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7Q0FDbkMsQ0FBQyxDQUFDOztBQUVILE1BQU0sQ0FBQyxPQUFPLENBQUM7Ozs7O0FBS2IsY0FBWSxFQUFFLG9CQUFVLEtBQUssRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFO0FBQ25ELFFBQUk7QUFDRixVQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUNqQiw4QkFBOEIsR0FBRyxLQUFLLEdBQUcsUUFBUSxFQUNqRDtBQUNFLGlCQUFTLEVBQUUsRUFBQyxZQUFZLEVBQUUsU0FBUyxFQUFDO0FBQ3BDLGdCQUFRLEVBQUU7QUFDUixnQkFBTSxFQUFFLFNBQVM7QUFDakIsb0JBQVUsRUFBRSxTQUFTO1NBQ3RCO09BQ0YsQ0FDSixDQUFBO0FBQ0QsYUFBTyxNQUFNLENBQUMsSUFBSSxDQUFDO0tBQ3BCLENBQUMsT0FBTyxHQUFHLEVBQUU7QUFDWCxZQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxnQ0FBZ0MsR0FBQyxHQUFHLENBQUMsQ0FBQztLQUMvRDtHQUdGOztDQUVGLENBQUMsQ0FBQyIsImZpbGUiOiIvc2VydmVyL3JlcG9zLnB1Ymxpc2guanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcclxuXHJcbk1ldGVvci5wdWJsaXNoKCdyZXBvcycsIGZ1bmN0aW9uKG9wdGlvbnMsIHNlYXJjaFN0cmluZykge1xyXG4gIHZhciB3aGVyZSA9IHtcclxuICAgICduYW1lJzoge1xyXG4gICAgICAnJHJlZ2V4JzogJy4qJyArIChzZWFyY2hTdHJpbmcgfHwgJycpICsgJy4qJyxcclxuICAgICAgJyRvcHRpb25zJzogJ2knXHJcbiAgICB9XHJcbiAgfTtcclxuICBDb3VudHMucHVibGlzaCh0aGlzLCAnbnVtYmVyT2ZSZXBvcycsIFJlcG9zLmZpbmQod2hlcmUpLCB7bm9SZWFkeTogdHJ1ZX0pO1xyXG4gIHJldHVybiBSZXBvcy5maW5kKHdoZXJlLCBvcHRpb25zKTtcclxufSk7XHJcblxyXG5NZXRlb3IubWV0aG9kcyh7XHJcblxyXG4gIC8qXHJcbiAgICogRmV0Y2ggcmVwb3NpdG9yaWVzIGZvciBnaXZlbiBvcmdcclxuICAgKi9cclxuICAnZmV0Y2hSZXBvcyc6IGZ1bmN0aW9uIChvcmdJZCwgc3RhcnRQYWdlLCBwYWdlTGltaXQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHZhciByZXN1bHQgPSBIVFRQLmdldChcclxuICAgICAgICAgICdodHRwczovL2FwaS5naXRodWIuY29tL29yZ3MvJyArIG9yZ0lkICsgJy9yZXBvcycsXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgICdoZWFkZXJzJzogeyd1c2VyLWFnZW50JzogJ25vZGUuanMnfSxcclxuICAgICAgICAgICAgJ3BhcmFtcyc6IHtcclxuICAgICAgICAgICAgICAncGFnZSc6IHN0YXJ0UGFnZSxcclxuICAgICAgICAgICAgICAncGVyX3BhZ2UnOiBwYWdlTGltaXRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICAgIHJldHVybiByZXN1bHQuZGF0YTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgdGhyb3cgbmV3IE1ldGVvci5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCByZXBvc2l0b3JpZXM6IFwiK2Vycik7XHJcbiAgICB9XHJcblxyXG5cclxuICB9XHJcblxyXG59KTsiXX0=
}).call(this);

//# sourceMappingURL=repos.publish.js.map
